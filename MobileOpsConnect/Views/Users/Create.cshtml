@{
    ViewData["Title"] = "Create New User";
    bool isSuperAdmin = ViewBag.IsSuperAdmin ?? false;
}

<!-- ═══════════════════════════════════════════════ -->
<!-- HERO BANNER                                     -->
<!-- ═══════════════════════════════════════════════ -->
<div class="moc-hero p-4 p-md-5 mb-4 text-white anim-fade-in">
    <div class="position-relative" style="z-index: 2;">
        <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
            <span class="badge rounded-pill px-3 py-2 text-sm" style="background:rgba(255,255,255,0.14);">
                <i class="bi bi-person-plus-fill text-success me-1" style="font-size:0.8rem;vertical-align:text-top;"></i>
                New Account
            </span>
            @if (isSuperAdmin)
            {
                <span class="badge rounded-pill px-3 py-2 text-sm" style="background:rgba(239,68,68,0.25);">
                    <i class="bi bi-shield-lock-fill me-1"></i> Alpha Privilege
                </span>
            }
        </div>
        <h1 class="display-5 fw-bold mb-2 letter-tight">Create New User</h1>
        <p class="lead mb-0 opacity-75">
            @if (isSuperAdmin)
            {
                @:Register a new System Administrator (Beta) account.
            }
            else
            {
                @:Add a new team member to the system with the appropriate role and permissions.
            }
        </p>
    </div>
    <div class="position-absolute top-50 end-0 translate-middle-y d-none d-lg-block pe-none"
         style="z-index:1;opacity:0.05;font-size:15rem;line-height:1;margin-right:1.5rem;">
        <i class="bi bi-person-plus-fill"></i>
    </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- ACTION BAR                                      -->
<!-- ═══════════════════════════════════════════════ -->
<div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4 anim-fade-in anim-delay-1">
    <a asp-action="Index" class="btn btn-moc-outline px-3">
        <i class="bi bi-arrow-left me-1"></i> Back to Users
    </a>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!-- FORM CARD                                       -->
<!-- ═══════════════════════════════════════════════ -->
<div class="row justify-content-center anim-fade-in anim-delay-2">
    <div class="col-lg-7">
        <div class="card moc-card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0 p-4 pb-0">
                <div class="d-flex align-items-center gap-2">
                    <div class="moc-icon-box bg-indigo-50 rounded-3">
                        <i class="bi bi-person-vcard text-indigo fs-5"></i>
                    </div>
                    <div>
                        <h6 class="fw-bold mb-0 letter-tight">Account Details</h6>
                        <span class="text-muted text-xs">Fill in all required fields to create a new user</span>
                    </div>
                </div>
            </div>
            <div class="card-body p-4 pt-3">
                <form asp-action="Create" method="post">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-3 text-sm" role="alert"></div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label class="form-label text-xs fw-semibold text-uppercase text-muted" style="letter-spacing:0.05em;">
                            <i class="bi bi-envelope me-1"></i> Email Address
                        </label>
                        <input name="email" type="email" class="form-control" required
                               placeholder="user@company.com"
                               style="border-radius:0.625rem;padding:0.625rem 1rem;" />
                    </div>

                    <!-- Password -->
                    <div class="mb-3">
                        <label class="form-label text-xs fw-semibold text-uppercase text-muted" style="letter-spacing:0.05em;">
                            <i class="bi bi-key me-1"></i> Password
                        </label>
                        <div class="input-group" style="border-radius:0.625rem;overflow:hidden;">
                            <input name="password" type="password" id="passwordField" class="form-control border-end-0"
                                   required placeholder="Enter a strong password"
                                   style="padding:0.625rem 1rem;" />
                            <button class="btn border border-start-0" type="button" id="togglePassword"
                                    style="background:#fff;color:#6b7280;" title="Show/Hide Password">
                                <i class="bi bi-eye" id="toggleIcon"></i>
                            </button>
                        </div>
                        <div class="mt-2 d-flex flex-wrap gap-1">
                            <span class="badge rounded-pill px-2 py-1 text-xs" style="background:rgba(99,102,241,0.08);color:#6366f1;">
                                <i class="bi bi-check2 me-1"></i> Uppercase
                            </span>
                            <span class="badge rounded-pill px-2 py-1 text-xs" style="background:rgba(99,102,241,0.08);color:#6366f1;">
                                <i class="bi bi-check2 me-1"></i> Number
                            </span>
                            <span class="badge rounded-pill px-2 py-1 text-xs" style="background:rgba(99,102,241,0.08);color:#6366f1;">
                                <i class="bi bi-check2 me-1"></i> Special Character
                            </span>
                        </div>
                    </div>

                    <!-- Role -->
                    <div class="mb-4">
                        <label class="form-label text-xs fw-semibold text-uppercase text-muted" style="letter-spacing:0.05em;">
                            <i class="bi bi-shield-check me-1"></i> Assign Role
                        </label>
                        <select name="role" class="form-select" style="border-radius:0.625rem;padding:0.625rem 1rem;">
                            @if (isSuperAdmin)
                            {
                                <option value="SystemAdmin">System Admin (Beta)</option>
                            }
                            else
                            {
                                <option value="DepartmentManager">Department Manager (Charlie)</option>
                                <option value="WarehouseStaff">Warehouse Staff (Delta)</option>
                                <option value="Employee">Employee (Echo)</option>
                            }
                        </select>
                        <div class="mt-2">
                            @if (isSuperAdmin)
                            {
                                <div class="d-flex align-items-center gap-2 p-2 rounded-3" style="background:rgba(239,68,68,0.05);">
                                    <i class="bi bi-info-circle text-danger"></i>
                                    <span class="text-xs text-muted">System Admins have elevated privileges. Assign with caution.</span>
                                </div>
                            }
                            else
                            {
                                <div class="d-flex align-items-center gap-2 p-2 rounded-3" style="background:rgba(99,102,241,0.05);">
                                    <i class="bi bi-info-circle" style="color:#6366f1;"></i>
                                    <span class="text-xs text-muted">The selected role determines the user's access level and permissions.</span>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-moc-primary flex-grow-1 py-2" style="border-radius:0.625rem;">
                            <i class="bi bi-person-plus me-2"></i> Create Account
                        </button>
                        <a asp-action="Index" class="btn btn-moc-outline px-4 py-2" style="border-radius:0.625rem;">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Toggle Password Script -->
<script>
(function () {
    const toggle = document.getElementById('togglePassword');
    const field = document.getElementById('passwordField');
    const icon = document.getElementById('toggleIcon');
    if (!toggle || !field || !icon) return;
    toggle.addEventListener('click', function () {
        const isPassword = field.type === 'password';
        field.type = isPassword ? 'text' : 'password';
        icon.className = isPassword ? 'bi bi-eye-slash' : 'bi bi-eye';
    });
})();
</script>